# Source

## Tools required

Binaries for tools that run on CP/M are in the tools folder.
The Microsoft .net 8.0 SDK is needed to build a tool used to add and remove CP/M Ctrl-Z from the source code.

NTVCM from https://github.com/davidly/ntvcm has been used to run the CP/M binaries under windows. 

## boot

`boot` contains code for the boot tracks, most of the `MAC` assembler files are just compiled and linked individually,  `LDRBIOS.MAC` is an exception to this it's output `LDRBIOS.REL`  gets linked with `CPMLDR.REL` from DRI.

The other file provided by DRI is the `CCP.bin` which is `CCP.COM` from a CP/M plus distribution. This is loaded into the alternate bank and copied into the CP/M runtime bank when the system warm boots. 

There are a few more comments to be added but most of the code is now understood.
*Note* the sectors on the first three tracks are in ProDOS sector order.

|Track| Sectors | 6502 load address | Code |
|-----|---------|-------------------|------|
| 0   | 0-1     | `$0800` | initial 6502 boot sector. |
| 0   | 2-F     | `$D000` | 6502 BIOS code. |
| 1   | 0-C     | `$1100` | CCP.COM |
| 1   | D-F     | `$1E00` | Cirtech toolkit strings |
| 2   | 0-F     | `$2100` | CPMLDR.COM - CP/M loader |

The `build.ps1` powershell script runs the NibReader tool over an image created from a
Cirtech CP/M boot disk, creating `.bin` binary image files. It then builds the assembler files
and links them into `.COM` files. Finally it compares the output `.COM` files with `.bin` files
generated by the NibReader. 

## cpm3bios

`cmp3bios` contains the source code to the main BIOS (or at least will do) along with the SPR files to build CPM3.SYS.
