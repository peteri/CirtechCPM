<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="SGStyle.css"/>

    <meta name="description" content="SourceGen-generated disassembly of CPMBoot.bin"/>
    <title>CPMBoot.bin Disassembly</title>
</head>

<body>

<p style="font-size:smaller;"><a href="./">(back to project page)</a></p>
<h1>CPMBoot.bin Disassembly</h1>

<div id="code-lines">
    <!-- The CodeLines marker is not optional, and may only appear once -->
<pre>                   ; 6502bench SourceGen v1.8.5
                   <span id="SymSLOTX16">SLOTX16</span>         .eq     $01    {addr/1}   ;Boot slot times sixteen
                   <span id="SymSLOTX">SLOTX</span>           .eq     $04    {addr/1}   ;SLOTX
                   <span id="SymMON_A4L">MON_A4L</span>         .eq     $42               ;general purpose
                   <span id="SymMON_A5H">MON_A5H</span>         .eq     $45               ;general purpose
                   <span id="SymDISKREADSECT">DISKREADSECT</span>    .eq     $c05c             ;ROM Disk read sector routine
                   <span id="SymIWM_PH0_OFF">IWM_PH0_OFF</span>     .eq     $c080             ;IWM phase 0 off
                   <span id="SymROMIN">ROMIN</span>           .eq     $c081             ;RWx2 read ROM, write RAM bank 2
                   <span id="SymIWM_PH1_OFF">IWM_PH1_OFF</span>     .eq     $c082             ;IWM phase 1 off
                   <span id="SymIWM_PH1_ON">IWM_PH1_ON</span>      .eq     $c083             ;IWM phase 1 on
                   <span id="SymLCBANK2">LCBANK2</span>         .eq     $c083             ;RWx2 read/write RAM bank 2
                   <span id="SymIWM_PH2_ON">IWM_PH2_ON</span>      .eq     $c085             ;IWM phase 2 on
                   <span id="SymLCBANK1">LCBANK1</span>         .eq     $c08b             ;RWx2 read/write RAM bank 1
                   <span id="SymMON_INIT">MON_INIT</span>        .eq     $fb2f             ;screen initialization
                   <span id="SymMON_PRERR">MON_PRERR</span>       .eq     $ff2d             ;print "ERR" and sound bell
                   <span id="SymMON_SAVE">MON_SAVE</span>        .eq     $ff4a             ;save 6502 registers to $45-49
                   <span id="SymMON_MONZ">MON_MONZ</span>        .eq     $ff69             ;reset and enter monitor

                                   .addrs  $0800
0800: 01                           .dd1    $01
                   sect_to_read    .var    $00    {addr/1}   ;sector we're going to read
                   data_ptr        .var    $26    {addr/2}   ;Pointer to BOOT1 databuffer
                   rom_sect_to_read .var   $3d    {addr/1}   ;Disk II sector to read
                   track           .var    $41    {addr/1}   ;track to read

0801: 86 01                        stx     <a href="#SymSLOTX16">SLOTX16</a>           ;Slot ($60 for disk ii in slot 6)
0803: 8a                           txa
0804: 4a                           lsr     A                 ;Divide by 16
0805: 4a                           lsr     A
0806: 4a                           lsr     A
0807: 4a                           lsr     A
0808: 85 04                        sta     <a href="#SymSLOTX">SLOTX</a>             ;Now we have slot number
080a: 09 c0                        ora     #$c0
080c: 8d 11 08                     sta     <a href="#SymREADCXFF">READCXFF</a>+2
080f: ad ff c0     <span id="SymREADCXFF">READCXFF</span>        lda     $c0ff             ;Check for Disk II 16 sector?
0812: f0 03        <span id="SymDISKII_TEST">DISKII_TEST</span>     beq     <a href="#SymDISKII_FOUND_INIT">DISKII_FOUND_INIT</a>
0814: 4c 34 09                     jmp     <a href="#SymIDCFOUND">IDCFOUND</a>          ;Found Intelligent Disk Controller

                   ; This code runs on the first boot sector, we read in the second sector to $900
                   ; Presumably to mimic a Intelligent Disk Controller aka Smart Drive, which has 
                   ; a sector size of 512 bytes. We skip this code on future reads.
0817: 8a           <span id="SymDISKII_FOUND_INIT">DISKII_FOUND_INIT</span> txa
0818: 18                           clc
0819: 69 04                        adc     #$04
081b: 8d b5 08                     sta     <a href="#SymSLOTXPLUS4">SLOTXPLUS4</a>
081e: 38                           sec
081f: e9 08                        sbc     #$08
0821: 8d b6 08                     sta     <a href="#SymSLOTXMINUS4">SLOTXMINUS4</a>
0824: ad 11 08                     lda     <a href="#SymREADCXFF">READCXFF</a>+2        ;Get back CX slot
0827: 8d 91 08                     sta     <a href="#SymJSRDISKIIREAD">JSRDISKIIREAD</a>+2   ;Update rom address we want to call
                   ; This constant is SKIP_DISKII_INIT - (DISKII_TEST+2)
082a: a9 22                        lda     #$22              ;Alter jump to skip next time we run
082c: 8d 13 08                     sta     <a href="#SymDISKII_TEST">DISKII_TEST</a>+1
082f: 20 a2 08                     jsr     <a href="#SymCLRSCR_ENABLELANGCARD">CLRSCR_ENABLELANGCARD</a>
0832: a9 00                        lda     #$00              ;We've read sector 0
0834: 85 00                        sta     sect_to_read
                   ; Future reads skip the code above and jump to here.
0836: e6 00        <span id="SymSKIP_DISKII_INIT">SKIP_DISKII_INIT</span> inc    sect_to_read      ;Add one to our sect to read
0838: a5 00                        lda     sect_to_read
083a: a6 41                        ldx     track             ;Still on track 0?
083c: d0 0a                        bne     <a href="#SymTRACK_READ_YET">TRACK_READ_YET</a>    ;Nope see if we've read the whole track
083e: c9 02                        cmp     #$02              ;Track 0 still, have read sector 1 yet?
0840: d0 06                        bne     <a href="#SymTRACK_READ_YET">TRACK_READ_YET</a>
0842: 48                           pha                       ;So now we've read in sectors 0 and 1 
0843: a9 d0                        lda     #$d0              ;We can start reading into the language card
0845: 85 27                        sta     data_ptr+1
0847: 68                           pla
0848: c9 10        <span id="SymTRACK_READ_YET">TRACK_READ_YET</span>  cmp     #$10              ;Done the whole track yet?
084a: d0 3a                        bne     <a href="#SymMAP_SECTOR_AND_READ">MAP_SECTOR_AND_READ</a>
                   ; Assuming Disk II in slot 6
                   ; First time X=$60
                   ; Write to $C0E0 (C080,X) IWM_PH0_OFF ; left on by C600 ROM
                   ; Write to $C0E3 (C083,X) IWM_PH1_ON  
                   ; Delay
                   ; Write to $C0E2 (C082,X) IWM_PH1_OFF
                   ; Write to $C0E5 (C085,X) IWM_PH2_ON
                   ; Read a whole track
084c: a6 01                        ldx     <a href="#SymSLOTX16">SLOTX16</a>
084e: a0 11                        ldy     #$11              ;Start loading in CPM stuff at $1100 (6520) 0100H Z80
0850: a5 41                        lda     track
0852: f0 09                        beq     <a href="#SymREAD_NEXT_TRK">READ_NEXT_TRK</a>
0854: c9 01                        cmp     #$01              ;Track one read in?
0856: d0 78                        bne     <a href="#SymCOPY_VECTORS_FIND_Z80">COPY_VECTORS_FIND_Z80</a> ;Done track two, fire up Z80
                   ; Second time X=$64
                   ; Write to $C0E4 (C080,X) IWM_PH2_OFF ; left on by C600 ROM
                   ; Write to $C0E7 (C083,X) IWM_PH3_ON  
                   ; Delay
                   ; Write to $C0E6 (C082,X) IWM_PH3_OFF
0858: ae b5 08                     ldx     <a href="#SymSLOTXPLUS4">SLOTXPLUS4</a>        ;Time to read track 2
085b: a4 27                        ldy     data_ptr+1
085d: 84 27        <span id="SymREAD_NEXT_TRK">READ_NEXT_TRK</span>   sty     data_ptr+1
085f: a9 00                        lda     #$00              ;Get sector zero
0861: 85 00                        sta     sect_to_read
0863: e6 41                        inc     track             ;Add one to the track
0865: bd 80 c0                     lda     <a href="#SymIWM_PH0_OFF">IWM_PH0_OFF</a>,x
0868: bd 83 c0                     lda     <a href="#SymIWM_PH1_ON">IWM_PH1_ON</a>,x      ;Move the head half track
086b: a9 56                        lda     #$56              ;Sleep for a bit
086d: 38                           sec
086e: 48           <span id="SymDELAY1">DELAY1</span>          pha
086f: e9 01        <span id="SymDELAY2">DELAY2</span>          sbc     #$01
0871: d0 fc                        bne     <a href="#SymDELAY2">DELAY2</a>
0873: 68                           pla
0874: e9 01                        sbc     #$01
0876: d0 f6                        bne     <a href="#SymDELAY1">DELAY1</a>
0878: bd 82 c0                     lda     <a href="#SymIWM_PH1_OFF">IWM_PH1_OFF</a>,x     ;Turn off the stepper motor
087b: ec b5 08                     cpx     <a href="#SymSLOTXPLUS4">SLOTXPLUS4</a>        ;Are we on track 1.5?
087e: d0 03                        bne     <a href="#SymREADTRK1">READTRK1</a>
                   ; Third time X=$5C
                   ; Write to $C0E1 (C085,X) IWM_PH0_ON
                   ; Read a whole track
0880: ae b6 08                     ldx     <a href="#SymSLOTXMINUS4">SLOTXMINUS4</a>       ;Time to go to track 2
0883: bd 85 c0     <span id="SymREADTRK1">READTRK1</span>        lda     <a href="#SymIWM_PH2_ON">IWM_PH2_ON</a>,x      ;Another half track
0886: a4 00        <span id="SymMAP_SECTOR_AND_READ">MAP_SECTOR_AND_READ</span> ldy sect_to_read      ;Get the prodos(?) style sector
0888: b9 92 08                     lda     <a href="#SymSECTORMAP">SECTORMAP</a>,y       ;Convert it for the ROM
088b: 85 3d                        sta     rom_sect_to_read
088d: a6 01                        ldx     <a href="#SymSLOTX16">SLOTX16</a>           ;Setup X register for ROM
088f: 4c 5c c0     <span id="SymJSRDISKIIREAD">JSRDISKIIREAD</span>   jmp     <a href="#SymDISKREADSECT">DISKREADSECT</a>      ;Read in the sector via ROM, reneter back at $801

0892: 00           <span id="SymSECTORMAP">SECTORMAP</span>       .dd1    $00
0893: 02                           .dd1    $02
0894: 04                           .dd1    $04
0895: 06                           .dd1    $06
0896: 08                           .dd1    $08
0897: 0a                           .dd1    $0a
0898: 0c                           .dd1    $0c
0899: 0e                           .dd1    $0e
089a: 01                           .dd1    $01
089b: 03                           .dd1    $03
089c: 05                           .dd1    $05
089d: 07                           .dd1    $07
089e: 09                           .dd1    $09
089f: 0b                           .dd1    $0b
08a0: 0d                           .dd1    $0d
08a1: 0f                           .dd1    $0f

08a2: 20 2f fb     <span id="SymCLRSCR_ENABLELANGCARD">CLRSCR_ENABLELANGCARD</span> jsr <a href="#SymMON_INIT">MON_INIT</a>        ;Clear 40 column etc
08a5: ad 0d c3                     lda     $c30d             ;Copy 80 column pascal init offset
08a8: 8d ac 08                     sta     <a href="#SymJSR80COLINIT">JSR80COLINIT</a>+1    ;Self modify so we can init the 80 column card
08ab: 20 00 c3     <span id="SymJSR80COLINIT">JSR80COLINIT</span>    jsr     $c300
08ae: ad 8b c0                     lda     <a href="#SymLCBANK1">LCBANK1</a>           ;Allow writes to language card
08b1: ad 8b c0                     lda     <a href="#SymLCBANK1">LCBANK1</a>
08b4: 60                           rts

08b5: 00           <span id="SymSLOTXPLUS4">SLOTXPLUS4</span>      .dd1    $00
08b6: 00           <span id="SymSLOTXMINUS4">SLOTXMINUS4</span>     .dd1    $00
08b7: 28 43 29 20+ <span id="SymCOPYRIGHT">COPYRIGHT</span>       .str    “(C) CIRTECH 1985 PAT PEND”

08d0: a0 1c        <span id="SymCOPY_VECTORS_FIND_Z80">COPY_VECTORS_FIND_Z80</span> ldy #$1c
08d2: b9 0c 09     <span id="SymCOPY_6502_LOOP">COPY_6502_LOOP</span>  lda     <a href="#SymVECTOR6502">VECTOR6502</a>-1,y
08d5: 99 bf 03                     sta     $03bf,y
08d8: 88                           dey
08d9: d0 f7                        bne     <a href="#SymCOPY_6502_LOOP">COPY_6502_LOOP</a>
08db: a0 0b                        ldy     #$0b
08dd: b9 28 09     <span id="SymCOPY_Z80_LOOP">COPY_Z80_LOOP</span>   lda     <a href="#SymVECTORZ80">VECTORZ80</a>-1,y
08e0: 99 ff 0f                     sta     $0fff,y
08e3: 88                           dey
08e4: d0 f7                        bne     <a href="#SymCOPY_Z80_LOOP">COPY_Z80_LOOP</a>
08e6: a2 e7                        ldx     #$e7              ;Z80 card swap from Z80 side
08e8: a0 c7                        ldy     #$c7              ;Z80 card swap from 6502 side
08ea: 8e df 03     <span id="SymPATCH_VECT_LOOP">PATCH_VECT_LOOP</span> stx     $03df             ;Patch back from Z80
08ed: 8c c8 03                     sty     $03c8             ;Patch go to Z80
08f0: 8c f5 08                     sty     <a href="#SymTEST_Z80_CARD">TEST_Z80_CARD</a>+2   ;Patch this test
08f3: 8d 00 c7     <span id="SymTEST_Z80_CARD">TEST_Z80_CARD</span>   sta     $c700
08f6: ca                           dex
08f7: 88                           dey
08f8: 2c 00 10                     bit     $1000
08fb: f0 0d                        beq     <a href="#SymSTART_Z80">START_Z80</a>
08fd: c0 c0                        cpy     #$c0              ;Out of card slots?
08ff: d0 e9                        bne     <a href="#SymPATCH_VECT_LOOP">PATCH_VECT_LOOP</a>
0901: ad 81 c0     <span id="SymL0901">L0901</span>           lda     <a href="#SymROMIN">ROMIN</a>
0904: 20 2d ff                     jsr     <a href="#SymMON_PRERR">MON_PRERR</a>
0907: 4c 69 ff                     jmp     <a href="#SymMON_MONZ">MON_MONZ</a>

090a: 4c c0 03     <span id="SymSTART_Z80">START_Z80</span>       jmp     $03c0

                   ; Jump code to and from the Z80
                   ; Copy this into $3C0 - $3DB
090d: ad 83 c0     <span id="SymVECTOR6502">VECTOR6502</span>      lda     <a href="#SymLCBANK2">LCBANK2</a>           ;$3C0
0910: ad 83 c0                     lda     <a href="#SymLCBANK2">LCBANK2</a>           ;$3C3
0913: 8d 00 c4                     sta     $c400             ;$3C6 (Patched when Z80 card found)
0916: ad 81 c0                     lda     <a href="#SymROMIN">ROMIN</a>             ;$3C9 Turn on ROM
0919: 20 8a 03                     jsr     $038a             ;$3cc No idea?
091c: 20 00 00                     jsr     $0000             ;$3CF 6502 routine?
091f: 8d 81 c0                     sta     <a href="#SymROMIN">ROMIN</a>             ;$3D2 STA so we don't overwrite it
0922: 78                           sei                       ;$3D5
0923: 20 4a ff                     jsr     <a href="#SymMON_SAVE">MON_SAVE</a>          ;$3D6 Save away the registers
0926: 4c c0 03                     jmp     $03c0             ;$3D9 Back to z80 land

0929: af           <span id="SymVECTORZ80">VECTORZ80</span>       .dd1    $af               ;xor a
092a: 32                           .dd1    $32               ;xor ($0000),a
092b: 00                           .dd1    $00
092c: 00                           .dd1    $00
092d: 2a                           .dd1    $2a               ;ld hl,($F3DE) Card return address to 6502
092e: de                           .dd1    $de
092f: f3                           .dd1    $f3
0930: 77                           .dd1    $77               ;ld (hl),a
0931: c3                           .dd1    $c3               ;jp $1100
0932: 00                           .dd1    $00
0933: 11                           .dd1    $11

0934: 20 a2 08     <span id="SymIDCFOUND">IDCFOUND</span>        jsr     <a href="#SymCLRSCR_ENABLELANGCARD">CLRSCR_ENABLELANGCARD</a>
0937: ad 11 08                     lda     <a href="#SymREADCXFF">READCXFF</a>+2
093a: 8d 7b 09                     sta     <a href="#SymL0979">L0979</a>+2
093d: 8d 48 09                     sta     <a href="#SymL0946">L0946</a>+2
0940: 8d 4b 09                     sta     <a href="#SymL0949">L0949</a>+2
0943: 8d bb 09                     sta     <a href="#SymL09B9">L09B9</a>+2
0946: ac ff c0     <span id="SymL0946">L0946</span>           ldy     $c0ff
0949: ad fb c0     <span id="SymL0949">L0949</span>           lda     $c0fb
094c: 4a                           lsr     A
094d: 90 3a                        bcc     <a href="#SymL0989">L0989</a>
094f: c8                           iny
0950: c8                           iny
0951: c8                           iny
0952: 8c 7a 09                     sty     <a href="#SymL0979">L0979</a>+1
0955: a9 d0                        lda     #$d0
0957: a2 0e                        ldx     #$0e
0959: a0 02                        ldy     #$02
095b: 20 70 09                     jsr     <a href="#SymL0970">L0970</a>
095e: a9 11                        lda     #$11
0960: a2 20                        ldx     #$20
0962: a0 10                        ldy     #$10
0964: 20 70 09                     jsr     <a href="#SymL0970">L0970</a>
0967: a5 01                        lda     <a href="#SymSLOTX16">SLOTX16</a>
0969: 09 01                        ora     #$01
096b: 85 01                        sta     <a href="#SymSLOTX16">SLOTX16</a>
096d: 4c d0 08                     jmp     <a href="#SymCOPY_VECTORS_FIND_Z80">COPY_VECTORS_FIND_Z80</a>

0970: 8d 83 09     <span id="SymL0970">L0970</span>           sta     <a href="#SymL0983">L0983</a>
0973: 8e 85 09                     stx     <a href="#SymL0985">L0985</a>
0976: 8c 87 09                     sty     <a href="#SymL0987">L0987</a>
0979: 20 00 00     <span id="SymL0979">L0979</span>           jsr     $0000
097c: 08                           php
097d: 80 09                        bra     <a href="#SymL0988">L0988</a>

097f: 60                           .dd1    $60
0980: 04                           .dd1    $04
0981: 01                           .dd1    $01
0982: 00                           .dd1    $00
0983: 00           <span id="SymL0983">L0983</span>           .dd1    $00
0984: 00                           .dd1    $00
0985: 00           <span id="SymL0985">L0985</span>           .dd1    $00
0986: 00                           .dd1    $00
0987: 00           <span id="SymL0987">L0987</span>           .dd1    $00

0988: 00           <span id="SymL0988">L0988</span>           brk

0989: 8c ba 09     <span id="SymL0989">L0989</span>           sty     <a href="#SymL09B9">L09B9</a>+1
098c: a5 01                        lda     <a href="#SymSLOTX16">SLOTX16</a>
098e: 8d d5 09                     sta     <a href="#SymL09D5">L09D5</a>
0991: 09 0f                        ora     #$0f
0993: 85 01                        sta     <a href="#SymSLOTX16">SLOTX16</a>
0995: a2 06                        ldx     #$06
0997: bd d4 09     <span id="SymL0997">L0997</span>           lda     <a href="#SymL09D4">L09D4</a>,x
099a: 95 42                        sta     <a href="#SymMON_A4L">MON_A4L</a>,x
099c: ca                           dex
099d: 10 f8                        bpl     <a href="#SymL0997">L0997</a>
099f: a2 07                        ldx     #$07
09a1: 8e cb 09                     stx     <a href="#SymL09CB">L09CB</a>
09a4: 8e ca 09                     stx     <a href="#SymL09CA">L09CA</a>
09a7: 20 b9 09                     jsr     <a href="#SymL09B9">L09B9</a>
09aa: a9 11                        lda     #$11
09ac: 85 45                        sta     <a href="#SymMON_A5H">MON_A5H</a>
09ae: a9 10                        lda     #$10
09b0: 8d ca 09                     sta     <a href="#SymL09CA">L09CA</a>
09b3: 20 b9 09                     jsr     <a href="#SymL09B9">L09B9</a>
09b6: 4c d0 08                     jmp     <a href="#SymCOPY_VECTORS_FIND_Z80">COPY_VECTORS_FIND_Z80</a>

09b9: 20 00 00     <span id="SymL09B9">L09B9</span>           jsr     $0000
09bc: b0 0e                        bcs     <a href="#SymL09CC">L09CC</a>
09be: e6 45                        inc     <a href="#SymMON_A5H">MON_A5H</a>
09c0: e6 45                        inc     <a href="#SymMON_A5H">MON_A5H</a>
09c2: e6 46                        inc     $46
09c4: ce ca 09                     dec     <a href="#SymL09CA">L09CA</a>
09c7: d0 f0                        bne     <a href="#SymL09B9">L09B9</a>
09c9: 60                           rts

09ca: 00           <span id="SymL09CA">L09CA</span>           .dd1    $00
09cb: 00           <span id="SymL09CB">L09CB</span>           .dd1    $00

09cc: ce cb 09     <span id="SymL09CC">L09CC</span>           dec     <a href="#SymL09CB">L09CB</a>
09cf: d0 e8                        bne     <a href="#SymL09B9">L09B9</a>
09d1: 4c 01 09                     jmp     <a href="#SymL0901">L0901</a>

09d4: 01           <span id="SymL09D4">L09D4</span>           .dd1    $01
09d5: 00           <span id="SymL09D5">L09D5</span>           .dd1    $00
09d6: 00                           .dd1    $00
09d7: d0                           .dd1    $d0
09d8: 01                           .dd1    $01
09d9: 00                           .dd1    $00
09da: 1a 1a 1a 1a+                 .fill   38,$1a
                                   .adrend ↑ $0800
</pre>


</div>

<!-- SymbolTable is optional; remove this entire section from the template if you don't want it -->
<div id="symbol-table">
    <h2>Symbol Table</h2>
<p>No exported symbols found.</p>

</div>

<div id="footer">
    <hr/>
    <p>HTML generated by <a href="https://6502bench.com/">6502bench SourceGen</a> v1.8.5
    on 2023/09/23 <!--18:18:45 +01:00--></p>
    <p>Expression style: Unknown</p>
    <!-- parameters: cols=16,8,18,100;extraCols=Address,Bytes;byteSpc=True;commaBulk=True;nonuPfx='@';varPfx='';labelBrk=False;notes=False;gfx=True;opWrap=64 -->
</div>

</body>
</html>
